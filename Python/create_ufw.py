#!/usr/bin/env python3
# This script implements UFW for all of the needed ports in SEL.
# To make modifications, just add a port to the list.
# Written by: Kelly Cantrell (8/18/25)

# Import Libraries
import subprocess

# Enable UFW
try:
    subprocess.run(['sudo', 'ufw', 'enable'], check=True, capture_output=True, text=True)
    print("üî•üß± UFW enabled successfully.")
except subprocess.CalledProcessError as e:
    print(f"‚ùå Error enabling UFW: {e}")
    print("Error output:", e.stderr)

# Create a list for all of the ports
ufw_ports = [
    2042, 4030, 4031, 4032, 4033, 4035, 4037, 4040, 4041, 4042, 4043, 4045, 4047,
    4050, 4051, 4052, 4053, 4055, 4070, 4071, 4072, 4073, 4075, 4076, 4080, 4081,
    4082, 4083, 4085, 4090, 4091, 4092, 4093, 4095, 4097, 9000, 9001, 9999,
    40100, 40101, 40102, 40103, 40104, 40120, 40121, 40122, 40199,
    40200, 40201, 40202, 40203, 40204, 40220, 40221, 40222, 40299,
    40300, 40301, 40302, 40303, 40304, 40320, 40321, 40322, 40399,
    40400, 40401, 40402, 40403, 40404, 40420, 40421, 40422, 40499,
    40500, 40501, 40502, 40503, 40504, 40520, 40521, 40522, 40599,
    40600, 40601, 40602, 40603, 40604, 40620, 40621, 40622, 40699,
    40800, 40801, 40802, 40803, 40804, 40820, 40821, 40822, 40899,
    40900, 40901, 40902, 40903, 40904, 40920, 40921, 40922, 40999,
    41000, 41001, 41002, 41003, 41004, 41020, 41021, 41022, 41099,
    41100, 41101, 41102, 41103, 41104, 41120, 41121, 41122, 41199,
    41200, 41201, 41202, 41203, 41204, 41220, 41221, 41222, 41299,
    41300, 41301, 41302, 41303, 41304, 41320, 41321, 41322, 41399,
    41400, 41401, 41402, 41403, 41404, 41420, 41421, 41422, 41499,
    41500, 41501, 41502, 41503, 41504, 41520, 41521, 41522, 41599,
    41700, 41701, 41702, 41703, 41704, 41720, 41721, 41722, 41799,
    43000, 43001, 43002, 43003, 43004, 43020, 43021, 43022, 43099,
    43100, 43101, 43102, 43103, 43104, 43120, 43121, 43122, 43199,
    43200, 43201, 43202, 43203, 43204, 43220, 43221, 43222, 43299,
    45000, 45001, 45002, 45003, 45004, 45020, 45021, 45022, 45099,
    47000, 47001, 47002, 47003, 47004, 47020, 47021, 47022, 47023, 47024, 47099,
    48000, 48001, 48002, 48003, 48004, 48020, 48021, 48022, 48099,
    48100, 48101, 48102, 48103, 48104, 48120, 48121, 48122, 48199,
    48300, 48301, 48302, 48303, 48304, 48320, 48321, 48322, 48399,
    50500, 50501, 50502, 50503, 50505, 50520, 50521, 50522, 50523, 50524, 50599,
    50700, 50701, 50702, 50703, 50704, 50720, 50721, 50722, 50723, 50724, 50799,
    50800, 50801, 50802, 50803, 50804, 50820, 50821, 50822, 50823, 50824, 50899,
    50900, 50901, 50902, 50903, 50904, 50920, 50921, 50922, 50923, 50924, 50999,
    51000, 51001, 51002, 51003, 51004, 51020, 51021, 51022, 51023, 51024, 51099,
    51100, 51101, 51102, 51103, 51104, 51120, 51121, 51122, 51123, 51124, 51199,
    51200, 51201, 51202, 51203, 51204, 51220, 51221, 51222, 51224, 51299,
    51300, 51301, 51302, 51303, 51304, 51320, 51321, 51322, 51324, 51399,
    51400, 51401, 51402, 51403, 51404, 51420, 51421, 51422, 51424, 51499,
    51500, 51501, 51502, 51503, 51504, 51520, 51521, 51522, 51523, 51524, 51599,
    51600, 51601, 51602, 51603, 51604, 51620, 51621, 51622, 51624, 51699,
    51700, 51701, 51702, 51703, 51704, 51720, 51721, 51722, 51723, 51724, 51799,
    53000, 53001, 53002, 53003, 53004, 53020, 53021, 53022, 53023, 53024, 50699,
    53100, 53101, 53102, 53103, 53104, 53120, 53121, 53122, 53123, 53124, 50299,
    53220, 53221, 53222, 53223, 53224, 50899,
    53300, 53301, 53302, 53303, 53304, 53320, 53321, 53322, 53323, 53324,
    53400, 53401, 53402, 53403, 53404, 53420, 53421, 53422, 53423, 53424,
    55020, 55021, 55022, 55023, 55024,
    57000, 57001, 57002, 57003, 57004, 57020, 57021, 57022, 57023, 57024, 57099,
    58000, 58001, 58002, 58003, 58004, 58020, 58021, 58022, 58099,
    58300, 58301, 58302, 58303, 58304, 58320, 58321, 58322, 58399,
    58800, 58801, 58802, 58803, 58804, 58820, 58821, 58822, 58899,
    59099
]

# Allow the above ports in a for loop
for port in ufw_ports:
    try:
        subprocess.run(["sudo", "ufw", "allow", str(port)], check=True),
        print(f"‚úÖ Allowed TCP port {port}")
    except subprocess.CalledProcessError as e:
        print(f"‚ùå Failed to allow port {port}: {e}")

# Finally, reload the firewall to apply changes
subprocess.run(["sudo", "firewall-cmd", "--reload"], check=True)